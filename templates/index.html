<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Поиск лекарств</title>
		<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
		<script type="text/javascript" src="{{ url_for('static', filename='script.js') }}"></script>
	</head>
	<body>
		{% from "macros/field.html" import render_text_field %}
		<div>
			{% if exception %}
				<span>{{ exception }}</span>
			{% endif %}
			<span class="title">Поиск лекарств</span>
			<form action="/search_page" method="post" id="search-form" class="search-form">
				{{ form.hidden_tag() }}
				{{ render_text_field(form.shop) }}
				{{ render_text_field(form.category) }}
				{{ render_text_field(form.min_price) }}
				{{ render_text_field(form.max_price) }}
				{{ render_text_field(form.discount) }}
				{{ render_text_field(form.name) }}
				<div>
					{{ form.mysubmit(class_="button button--form") }}
				</div>
			</form>
			{% if items %}
				<table id="search-result" class="sortable">
					<caption>Результат поиска</caption>
					<thead>
						<tr>
							<th onclick="sortTable(0)">#<span class="table-header-sort-dir"></span></th>
							<th onclick="sortTable(1)">Магазин<span class="table-header-sort-dir"></span></th>
							<th onclick="sortTable(2)">Категория<span class="table-header-sort-dir"></span></th>
							<th onclick="sortTable(3)">Наименование<span class="table-header-sort-dir"></span></th>
							<th onclick="sortTable(4)">Цена<span class="table-header-sort-dir"></span ></th>
						</tr>
					</thead>
					<tbody>
						{% for item in items %}
							<tr>
								<td><span>{{ (page - 1) * items_show_limit + loop.index }}</span></td>
								<td>{{ item['Магазин'] }}</td>
								<td>{{ item['Категория'] }}</td>
								<td><a href="{{ item[Ссылка] }}" target="_blank" rel="noopener noreferrer">{{ item['Название'] }}</a></td>
								{% if item['Цена'] == item['Цена без скидки'] %}
									<td><span>{{ item['Цена'] }}</span></td>
								{% else %}
									<td><span>{{ item['Цена'] }}</span> <s><small>{{ item['Цена без скидки'] }}</small></s></td>
								{% endif %}
							</tr>
						{% endfor %}
					</tbody>
					{% if min_page < max_page %}
						<tfoot>
							<tr>
								<td class="search-result-footer" colspan="5">
									{% if page > min_page %}
										<a class="button" href="javascript:{}" onclick="
											search_form = document.getElementById('search-form');
											search_form.page.value = +search_form.min_page.value;
											search_form.submit();
										">&lt;&lt;</a>
										<a class="button" href="javascript:{}" onclick="
											search_form = document.getElementById('search-form');
											search_form.page.value = +search_form.page.value - 1;
											search_form.submit();
										">&lt;</a>
									{% endif %}
									{% for p in shown_pages %}
										{% if page == p %}
											<a class="button-disabled"><b>{{ p }}</b></a>
										{% else %}
											<a class="button" href="javascript:{}" onclick="
												search_form = document.getElementById('search-form');
												search_form.page.value = +`{{ p }}`;
												search_form.submit();
											">{{ p }}</a>
										{% endif %}									
									{% endfor %}
									{% if page < max_page %}
										<a class="button" href="javascript:{}" onclick="
											search_form = document.getElementById('search-form');
											search_form.page.value = +search_form.page.value + 1;
											search_form.submit();
										">&gt;</a>
										<a class="button" href="javascript:{}" onclick="
											search_form = document.getElementById('search-form');
											search_form.page.value = +search_form.max_page.value;
											search_form.submit();
										">&gt;&gt;</a>
									{% endif %}
								</td>
							</tr>
						</tfoot>
					{% endif %}
				</table>
			{% endif %}
		</div>
	</body>
</html>